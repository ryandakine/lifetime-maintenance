import{s as A,T as K,A as ge,j as e}from"./main-D2OIwsnq.js";import{r as n}from"./vendor-B6114-rA.js";import{L as ue,l as H,n as k,j as me,s as he,G as fe,m as xe,o as ye,t as we,u as be,T as ve,W as je,v as Se,w as Q}from"./ui-7hvmghxF.js";import"./redux-CQk40qEf.js";const Ne=()=>{console.log("Rendering Knowledge");const[h,C]=n.useState([]),[E,q]=n.useState(!1),[R,P]=n.useState({type:"",text:""}),[J,M]=n.useState(navigator.onLine),[d,f]=n.useState(""),[T,B]=n.useState(!1),[g,Y]=n.useState(""),[y,x]=n.useState([]),[a,U]=n.useState(null),[w,G]=n.useState("list"),[p,b]=n.useState(!1),[z,V]=n.useState(""),[O,D]=n.useState(null),[X,F]=n.useState(!1),[u,v]=n.useState(""),[j,S]=n.useState(!1),[m,Z]=n.useState(null),[W,ee]=n.useState([]),[ke,Ce]=n.useState(!1);n.useEffect(()=>{const o=()=>M(!0),r=()=>M(!1);return window.addEventListener("online",o),window.addEventListener("offline",r),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",r)}},[]),n.useEffect(()=>{L()},[]),n.useEffect(()=>{const o=localStorage.getItem("voiceKnowledge");o&&(f(o),localStorage.removeItem("voiceKnowledge"),setTimeout(()=>{N()},500))},[]),n.useEffect(()=>{if(!g.trim())x(h);else{const o=h.filter(r=>r.question.toLowerCase().includes(g.toLowerCase())||r.response.toLowerCase().includes(g.toLowerCase()));x(o)}},[g,h]);const L=async()=>{try{q(!0);const{data:o,error:r}=await A.from(K.KNOWLEDGE).select("*").eq("user_id","current-user").order("created_at",{ascending:!1});if(r)throw r;C(o||[]),x(o||[]),console.log("Knowledge entries loaded:",(o==null?void 0:o.length)||0)}catch(o){console.error("Error loading knowledge entries:",o),console.log("Knowledge component: Data load failed, showing fallback"),c("error","Failed to load knowledge entries"),C([]),x([])}finally{q(!1)}},N=async()=>{if(d.trim())try{B(!0);const o=ge.GROK_PRO;if(!o||o==="your-grok-key"){console.warn("Grok Pro API key not configured, using fallback response");const t=`Steps to ${d}:
1. Gather necessary tools and supplies
2. Ensure safety measures are in place
3. Follow standard maintenance procedures
4. Test the completed work
5. Document any issues or notes

Tools needed: Basic maintenance tools
Supplies needed: Standard maintenance supplies
Time estimate: 1-2 hours
Difficulty: Moderate

Note: This is a fallback response. Configure Grok Pro API for detailed, specific guidance.`;await I(d,t);return}console.log("Processing question with Grok Pro...");const r=await fetch("https://api.x.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:"grok-beta",messages:[{role:"system",content:`You are a professional maintenance expert for Lifetime Fitness facilities. Provide detailed, step-by-step instructions for maintenance and repair tasks. Always include:
1. Safety considerations
2. Required tools (specific tool names)
3. Required supplies (specific part numbers or descriptions)
4. Time estimates
5. Difficulty level
6. Step-by-step instructions
7. Troubleshooting tips

Format your response with clear sections and bullet points. Be specific and practical.`},{role:"user",content:`Provide detailed maintenance instructions for: ${d}

Include:
- Safety considerations
- Required tools (be specific)
- Required supplies (be specific)
- Time estimate
- Difficulty level (Easy/Moderate/Difficult)
- Step-by-step instructions
- Troubleshooting tips

Format with clear sections and use bullet points for easy reading.`}],max_tokens:2e3,temperature:.3})});if(!r.ok){const t=await r.text();throw console.error("Grok API error:",r.status,t),new Error(`Grok API error: ${r.status}`)}const i=(await r.json()).choices[0].message.content;console.log("Grok response generated:",i),await I(d,i)}catch(o){console.error("Error processing question:",o),c("error","Failed to process question. Using fallback response.");const r=`Steps to ${d}:
1. Gather necessary tools and supplies
2. Ensure safety measures are in place
3. Follow standard maintenance procedures
4. Test the completed work
5. Document any issues or notes

Tools needed: Basic maintenance tools
Supplies needed: Standard maintenance supplies
Time estimate: 1-2 hours
Difficulty: Moderate

Note: This is a fallback response. Configure Grok Pro API for detailed, specific guidance.`;await I(d,r)}finally{B(!1),f("")}},I=async(o,r)=>{try{const{error:s}=await A.from(K.KNOWLEDGE).insert({user_id:"current-user",question:o,response:r,created_at:new Date().toISOString()});if(s)throw s;console.log("Knowledge entry saved successfully"),c("success","Knowledge entry created successfully"),await L()}catch(s){console.error("Error saving knowledge entry:",s),c("error","Failed to save knowledge entry")}},oe=async o=>{try{const{error:r}=await A.from(K.KNOWLEDGE).delete().eq("id",o);if(r)throw r;C(h.filter(s=>s.id!==o)),x(y.filter(s=>s.id!==o)),console.log(`Knowledge entry ${o} deleted`),c("success","Knowledge entry deleted")}catch(r){console.error("Error deleting knowledge entry:",r),c("error","Failed to delete knowledge entry")}},$=async o=>{try{await navigator.clipboard.writeText(o),c("success","Copied to clipboard")}catch(r){console.error("Error copying to clipboard:",r),c("error","Failed to copy to clipboard")}},re=o=>o.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>").replace(/^- (.*)/gm,"â€¢ $1"),se=o=>{switch(o==null?void 0:o.toLowerCase()){case"easy":return"var(--success-color)";case"moderate":return"var(--warning-color)";case"difficult":return"var(--danger-color)";default:return"var(--secondary-color)"}},te=o=>{const r=[],s=[];return o.split(`
`).forEach(t=>{t.toLowerCase().includes("tool")&&!t.toLowerCase().includes("supply")&&r.push(t.replace(/.*tool.*?:/i,"").trim()),t.toLowerCase().includes("supply")&&s.push(t.replace(/.*supply.*?:/i,"").trim())}),{tools:r,supplies:s}},c=(o,r)=>{P({type:o,text:r}),setTimeout(()=>P({type:"",text:""}),5e3)},ie=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){c("error","Speech recognition not supported");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition,r=new o;r.continuous=!1,r.interimResults=!0,r.lang="en-US",r.onstart=()=>{b(!0),V("")},r.onresult=i=>{let t="";for(let l=i.resultIndex;l<i.results.length;l++)i.results[l].isFinal&&(t+=i.results[l][0].transcript);t&&(V(t),f(t))},r.onend=()=>{b(!1),z&&N()},r.onerror=i=>{console.error("Speech recognition error:",i.error),b(!1)};const s=setTimeout(()=>{r.stop(),r.abort()},3e4);D(s),r.start()},ne=()=>{O&&(clearTimeout(O),D(null));try{window.speechRecognition&&(window.speechRecognition.stop(),window.speechRecognition.abort())}catch{console.log("Recognition already stopped")}b(!1),c("info","Voice input stopped.")},ae=()=>{F(!0),v("")},_=()=>{F(!1),v(""),m&&(m.stop(),m.abort())},le=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){c("error","Speech recognition not supported");return}const o=window.SpeechRecognition||window.webkitSpeechRecognition,r=new o;r.continuous=!1,r.interimResults=!0,r.lang="en-US",r.onstart=()=>{S(!0)},r.onresult=s=>{let i="";for(let t=s.resultIndex;t<s.results.length;t++)s.results[t].isFinal&&(i+=s.results[t][0].transcript);i&&v(t=>t+i+" ")},r.onend=()=>{S(!1)},r.onerror=s=>{console.error("Speech recognition error:",s.error),S(!1)},r.start(),Z(r)},ce=()=>{m&&(m.stop(),m.abort(),S(!1))},de=()=>{u.trim()&&(f(u.trim()),_())},pe=async()=>{try{console.log("Perplexity API key not configured");return}catch(o){console.error("Error generating AI suggestions:",o)}};return e.jsxs("div",{className:"container",children:[!J&&e.jsx("div",{className:"offline-alert",children:"âš ï¸ You are currently offline. Knowledge search may not work properly."}),R.text&&e.jsx("div",{className:`message ${R.type}`,children:R.text}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Maintenance Knowledge Base"}),e.jsx("p",{style:{color:"var(--secondary-color)",marginBottom:"1rem"},children:"Ask questions about maintenance procedures and get detailed, step-by-step instructions with tools and supplies."}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"knowledge-question",children:"What maintenance question do you have?"}),e.jsx("textarea",{id:"knowledge-question",name:"knowledge-question",className:"form-input",value:d,onChange:o=>f(o.target.value),placeholder:"Example: How to change a light bulb, How to fix HVAC filter, How to repair concrete cracks",rows:3,disabled:T})]}),e.jsx("button",{className:"btn",onClick:N,disabled:!d.trim()||T,title:"Get maintenance knowledge","aria-label":"Get maintenance knowledge",children:T?e.jsxs(e.Fragment,{children:[e.jsx(ue,{size:16,style:{marginRight:"0.5rem",animation:"spin 1s linear infinite"},"aria-hidden":"true"}),"Generating response..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:16,style:{marginRight:"0.5rem"},"aria-hidden":"true"}),"Get Knowledge"]})}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:p?"var(--warning-color)":"var(--light-color)",borderRadius:"8px",border:p?"2px solid var(--warning-color)":"1px solid var(--border-color)",textAlign:"center"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",color:p?"white":"var(--primary-color)",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(k,{size:20}),"Voice Input"]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginBottom:"1rem"},children:[e.jsx("button",{onClick:p?ne:ie,style:{padding:"1rem 2rem",borderRadius:"50px",border:"none",backgroundColor:p?"#dc3545":"var(--primary-color)",color:"white",cursor:"pointer",fontSize:"1.1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.3s ease",boxShadow:p?"0 0 20px rgba(220, 53, 69, 0.5)":"0 2px 8px rgba(0,0,0,0.1)",animation:p?"pulse 2s infinite":"none"},children:p?e.jsxs(e.Fragment,{children:[e.jsx(Square,{size:20}),"STOP LISTENING"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:20}),"Quick Voice"]})}),e.jsxs("button",{onClick:ae,style:{padding:"1rem 2rem",borderRadius:"50px",border:"2px solid var(--primary-color)",backgroundColor:"white",color:"var(--primary-color)",cursor:"pointer",fontSize:"1.1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.3s ease"},children:[e.jsx(k,{size:20}),"Voice Modal"]})]}),p&&e.jsx("div",{style:{color:"white",fontSize:"0.9rem",marginBottom:"0.5rem",textAlign:"center",fontWeight:"600"},children:'ðŸŽ¤ LISTENING - Click "STOP LISTENING" to stop'}),z&&e.jsxs("div",{style:{marginTop:"0.5rem",padding:"0.5rem",backgroundColor:"white",borderRadius:"4px",fontSize:"0.9rem",color:"var(--text-color)",minHeight:"40px"},children:[e.jsx("strong",{children:"You said:"})," ",z]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--light-color)",borderRadius:"8px"},children:[e.jsxs("h4",{style:{marginBottom:"0.5rem",color:"var(--primary-color)"},children:[e.jsx(me,{size:16,style:{marginRight:"0.5rem"},"aria-hidden":"true"}),"Knowledge Features"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--secondary-color)"},children:[e.jsx("div",{children:"â€¢ Step-by-step maintenance instructions"}),e.jsx("div",{children:"â€¢ Required tools and supplies lists"}),e.jsx("div",{children:"â€¢ Safety considerations and time estimates"}),e.jsx("div",{children:"â€¢ Difficulty levels and troubleshooting tips"})]})]}),e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--light-color)",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h4",{style:{color:"var(--primary-color)",margin:0},children:"ðŸ¤– AI Knowledge Suggestions"}),e.jsxs("button",{onClick:pe,style:{padding:"0.5rem 1rem",borderRadius:"4px",border:"1px solid var(--border-color)",backgroundColor:"var(--primary-color)",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(H,{size:16}),"Get AI Suggestions"]})]}),W.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:W.map((o,r)=>e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"white",borderRadius:"6px",border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"0.25rem"},children:o.suggestion}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--secondary-color)"},children:o.reason})]},r))})]})]}),X&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"12px",width:"90%",maxWidth:"500px",boxShadow:"0 10px 25px rgba(0, 0, 0, 0.2)"},children:[e.jsx("h3",{style:{marginBottom:"1rem",color:"var(--primary-color)"},children:"ðŸŽ¤ Voice Knowledge Input"}),e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("textarea",{value:u,onChange:o=>v(o.target.value),placeholder:"Your voice input will appear here...",style:{width:"100%",minHeight:"100px",padding:"0.75rem",borderRadius:"8px",border:"1px solid var(--border-color)",fontSize:"0.9rem",resize:"vertical"}})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsxs("button",{onClick:j?ce:le,style:{padding:"0.75rem 1.5rem",borderRadius:"8px",border:"none",backgroundColor:j?"#dc3545":"var(--primary-color)",color:"white",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[j?e.jsx(Square,{size:16}):e.jsx(k,{size:16}),j?"Stop":"Start"," Recording"]}),e.jsx("button",{onClick:de,disabled:!u.trim(),style:{padding:"0.75rem 1.5rem",borderRadius:"8px",border:"none",backgroundColor:u.trim()?"var(--success-color)":"var(--secondary-color)",color:"white",cursor:u.trim()?"pointer":"not-allowed"},children:"Ask Question"}),e.jsx("button",{onClick:_,style:{padding:"0.75rem 1.5rem",borderRadius:"8px",border:"1px solid var(--border-color)",backgroundColor:"white",color:"var(--text-color)",cursor:"pointer"},children:"Cancel"})]})]})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"Knowledge Library"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>G("list"),style:{backgroundColor:w==="list"?"var(--primary-color)":"var(--secondary-color)",color:"white"},title:"View as list","aria-label":"View as list",children:e.jsx(he,{size:16,"aria-hidden":"true"})}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>G("grid"),style:{backgroundColor:w==="grid"?"var(--primary-color)":"var(--secondary-color)",color:"white"},title:"View as grid","aria-label":"View as grid",children:e.jsx(fe,{size:16,"aria-hidden":"true"})}),e.jsx("button",{className:"btn btn-secondary",onClick:L,disabled:E,title:"Refresh knowledge base","aria-label":"Refresh knowledge base",children:e.jsx(xe,{size:16,"aria-hidden":"true"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",htmlFor:"knowledge-search",children:"Search Knowledge"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",className:"form-input",value:g,onChange:o=>Y(o.target.value),placeholder:"Search questions and responses...",style:{flex:1},title:"Search knowledge base","aria-label":"Search knowledge base",id:"knowledge-search",name:"knowledge-search"}),e.jsx(ye,{size:16,style:{color:"var(--secondary-color)",marginTop:"0.5rem"},"aria-hidden":"true"})]})]}),E&&y.length===0?e.jsx("div",{className:"loading",children:"Loading knowledge entries..."}):y.length===0?e.jsx("p",{style:{textAlign:"center",color:"var(--secondary-color)"},children:g?"No matching knowledge entries found.":"No knowledge entries yet. Ask a question above to get started!"}):e.jsx("div",{style:{display:w==="grid"?"grid":"flex",flexDirection:"column",gap:"1rem",gridTemplateColumns:w==="grid"?"repeat(auto-fill, minmax(300px, 1fr))":"none"},children:y.map(o=>{var t;const{tools:r,supplies:s}=te(o.response),i=((t=o.response.match(/difficulty.*?:.*?(easy|moderate|difficult)/i))==null?void 0:t[1])||"moderate";return e.jsxs("div",{style:{border:"1px solid var(--border-color)",borderRadius:"8px",padding:"1rem",backgroundColor:"var(--light-color)",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>U((a==null?void 0:a.id)===o.id?null:o),title:`View knowledge entry: ${o.question}`,"aria-label":`View knowledge entry: ${o.question}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("h4",{style:{margin:"0 0 0.5rem 0",color:"var(--primary-color)",fontSize:"1rem"},children:[e.jsx(we,{size:16,style:{marginRight:"0.5rem"},"aria-hidden":"true"}),o.question]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--secondary-color)"},children:[e.jsx(be,{size:12,style:{marginRight:"0.25rem"},"aria-hidden":"true"}),new Date(o.created_at).toLocaleDateString(),e.jsx("span",{style:{margin:"0 0.5rem"},children:"â€¢"}),e.jsx("span",{style:{color:se(i),fontWeight:"500"},children:i.charAt(0).toUpperCase()+i.slice(1)})]})]}),e.jsx("button",{className:"btn btn-danger",onClick:l=>{l.stopPropagation(),oe(o.id)},style:{padding:"0.25rem 0.5rem",fontSize:"0.8rem"},title:"Delete entry","aria-label":"Delete entry",children:e.jsx(ve,{size:14,"aria-hidden":"true"})})]}),(r.length>0||s.length>0)&&e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[r.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem",marginBottom:"0.25rem"},children:[e.jsx(je,{size:12,style:{color:"var(--primary-color)"},"aria-hidden":"true"}),e.jsx("span",{style:{color:"var(--secondary-color)"},children:"Tools:"}),e.jsxs("span",{style:{fontSize:"0.75rem"},children:[r.slice(0,2).join(", "),r.length>2?"...":""]})]}),s.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.8rem"},children:[e.jsx(Se,{size:12,style:{color:"var(--primary-color)"},"aria-hidden":"true"}),e.jsx("span",{style:{color:"var(--secondary-color)"},children:"Supplies:"}),e.jsxs("span",{style:{fontSize:"0.75rem"},children:[s.slice(0,2).join(", "),s.length>2?"...":""]})]})]}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-color)",lineHeight:"1.4",maxHeight:(a==null?void 0:a.id)===o.id?"none":"3rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:(a==null?void 0:a.id)===o.id?"none":2,WebkitBoxOrient:"vertical"},children:(a==null?void 0:a.id)===o.id?e.jsx("div",{dangerouslySetInnerHTML:{__html:re(o.response)},style:{whiteSpace:"pre-line"}}):o.response.substring(0,150)+(o.response.length>150?"...":"")}),(a==null?void 0:a.id)===o.id&&e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"1rem"},children:[e.jsxs("button",{className:"btn btn-outline",onClick:l=>{l.stopPropagation(),$(o.response)},style:{fontSize:"0.8rem",padding:"0.25rem 0.5rem"},title:"Copy response","aria-label":"Copy response",children:[e.jsx(Q,{size:12,style:{marginRight:"0.25rem"},"aria-hidden":"true"}),"Copy"]}),e.jsxs("button",{className:"btn btn-outline",onClick:l=>{l.stopPropagation(),$(o.question)},style:{fontSize:"0.8rem",padding:"0.25rem 0.5rem"},title:"Copy question","aria-label":"Copy question",children:[e.jsx(Q,{size:12,style:{marginRight:"0.25rem"},"aria-hidden":"true"}),"Copy Question"]})]})]},o.id)})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]})};export{Ne as default};
//# sourceMappingURL=Knowledge-baEqYva6.js.map
