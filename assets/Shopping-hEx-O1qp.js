import{s as se,T as ie,A as oe,j as e}from"./main-D2OIwsnq.js";import{r as o}from"./vendor-B6114-rA.js";import{d as re,M as $,e as Ie,f as Le,L as Ae,g as Ee,h as Te,W as _e,i as Ce,D as Pe,j as Me}from"./ui-7hvmghxF.js";import"./redux-CQk40qEf.js";const i={primary:"#1a3d2f",accent:"#bfc1c2",background:"#f5f6f7",white:"#fff",black:"#222",highlight:"#e6f4ea"},Ke=()=>{console.log("Rendering Shopping");const[Oe,N]=o.useState([]),[ze,ae]=o.useState([]),[$e,B]=o.useState(!1),[A,W]=o.useState({type:"",text:""}),[Ne,V]=o.useState(navigator.onLine),[w,E]=o.useState(""),[q,D]=o.useState(!1),[Be,We]=o.useState(""),[Ve,qe]=o.useState(!1),[De,Ge]=o.useState("");o.useRef(null),o.useRef(null);const[g,G]=o.useState("main"),[m,k]=o.useState([]),[f,v]=o.useState([]),[H,ce]=o.useState([]),[T,le]=o.useState({}),[J,de]=o.useState(""),[_,Y]=o.useState(""),[F,C]=o.useState(""),[K,U]=o.useState(!1),[p,R]=o.useState(!1),[Q,pe]=o.useState(""),u=o.useRef(null),l=o.useRef(null),[ge,X]=o.useState(!1),[y,I]=o.useState(""),[x,b]=o.useState(!1),d=o.useRef(null),ue={Electrical:["bulb","outlet","wire","extension cord","batteries","switch"],Plumbing:["toilet","flapper","pipe","caulk"],Paint:["paint","roller","brush"],Tools:["wrench","screwdriver","zip ties"],Misc:[]},he={paint:["Paint tray","Painterâ€™s tape","Drop cloth"],toilet:["Wax ring","Toilet bolts"],bulb:["Light fixture","Dimmer switch"],filter:["Replacement filter","Filter cleaner"],batteries:["Battery tester"],outlet:["Outlet cover","GFCI outlet"],pipe:["Pipe tape","Pipe insulation"],roller:["Paint tray liner"],wrench:["Pipe wrench","Adjustable wrench"]},me={Electrical:e.jsx(Me,{size:18,style:{marginRight:4}}),Plumbing:e.jsx(Pe,{size:18,style:{marginRight:4}}),Paint:e.jsx(Ce,{size:18,style:{marginRight:4}}),Tools:e.jsx(_e,{size:18,style:{marginRight:4}}),Misc:e.jsx(Te,{size:18,style:{marginRight:4}})};o.useEffect(()=>{const t=()=>V(!0),n=()=>V(!1);return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}},[]),o.useEffect(()=>{fe(),ye()},[]),o.useEffect(()=>{const t=JSON.parse(localStorage.getItem("shoppingList_main")||"[]"),n=JSON.parse(localStorage.getItem("shoppingList_misc")||"[]");k(t),v(n)},[]),o.useEffect(()=>{localStorage.setItem("shoppingList_main",JSON.stringify(m))},[m]),o.useEffect(()=>{localStorage.setItem("shoppingList_misc",JSON.stringify(f))},[f]),o.useEffect(()=>{const t=localStorage.getItem("voiceShopping");t&&(E(t),localStorage.removeItem("voiceShopping"),setTimeout(()=>{P()},500))},[]);const fe=async()=>{try{B(!0);const{data:t,error:n}=await se.from(ie.SHOPPING_LISTS).select("*").eq("user_id","current-user").order("created_at",{ascending:!1});if(n)throw n;N(t||[]),console.log("Shopping lists loaded:",(t==null?void 0:t.length)||0)}catch(t){console.error("Error loading shopping lists:",t),console.log("Shopping component: Data load failed, showing fallback"),ee("error","Failed to load shopping lists"),N([])}finally{B(!1)}},ye=async()=>{try{const{data:t,error:n}=await se.from(ie.TASKS).select("id, task_list, status").eq("user_id","current-user").order("created_at",{ascending:!1});if(n)throw n;ae(t||[])}catch(t){console.error("Error loading tasks:",t)}},P=async()=>{if(w.trim())try{D(!0);const t=oe.PERPLEXITY_PRO;if(!t||t==="your-perplexity-key"){console.warn("Perplexity Pro API key not configured, using fallback parsing");const n=w.split(`
`).filter(s=>s.trim()).map(s=>{const r=s.match(/^(\d+)\s+([A-Za-z0-9\- ]+)?(.*)$/);let c=1,h=s.trim(),L="";if(r)c=parseInt(r[1],10),h=(r[2]+(r[3]||"")).trim();else{const j=s.match(/^(\w+)\s+(.+)$/);j&&(L=j[1],h=j[2])}return{name:h,quantity:c,brand:L,grainger_part:"N/A",grainger_url:"",home_depot_aisle:"N/A"}});Z(n)}else{const n=await fetch("https://api.perplexity.ai/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4",messages:[{role:"user",content:`Parse the following shopping list and return it in a JSON array of objects. Each object should have 'name', 'quantity', 'brand', 'grainger_part', 'grainger_url', 'home_depot_aisle'. If a part number or URL is not available, set it to 'N/A'. For example: [{"name": "LED bulbs", "quantity": 10, "brand": "GE", "grainger_part": "123456", "grainger_url": "https://www.grainger.com/part/123456", "home_depot_aisle": "Aisle 10"}, {"name": "HVAC filter", "quantity": 2, "brand": "Honeywell", "grainger_part": "789012", "grainger_url": "https://www.grainger.com/part/789012", "home_depot_aisle": "Aisle 5"}]`}]})});if(!n.ok)throw new Error(`Perplexity API error: ${n.statusText}`);const r=(await n.json()).choices[0].message.content,c=JSON.parse(r);Z(c)}}catch(t){console.error("Error processing voice input:",t),ee("error","Failed to process voice input")}finally{D(!1)}},Z=t=>{const n=t.map(a=>{let S="Misc";for(const[z,ve]of Object.entries(ue))if(ve.some(Re=>a.name.toLowerCase().includes(Re))){S=z;break}return{...a,category:S}});let s=[];n.forEach(a=>{for(const[S,z]of Object.entries(he))a.name.toLowerCase().includes(S)&&(s=[...s,...z])}),ce(s);const r=[...m,...f,...n],c={};r.forEach(a=>{c[a.name]||(c[a.name]=0),c[a.name]++});const h=Object.entries(c).filter(([a,S])=>S>2).map(([a])=>a);h.length&&de(`Reminder: You often buy ${h.join(", ")}. Need again?`);const L=r.filter(a=>a.checked).length,j=r.length,O={};r.forEach(a=>{O[a.category]=(O[a.category]||0)+1}),le({total:j,completed:L,byCategory:O}),g==="main"?k(a=>[...a,...n]):v(a=>[...a,...n])},xe=t=>{const n=g==="main"?m[t]:f[t];g==="main"?(k(m.filter((s,r)=>r!==t)),v(s=>[...s,n])):(v(f.filter((s,r)=>r!==t)),k(s=>[...s,n]))},ee=(t,n)=>{W({type:t,text:n}),setTimeout(()=>W({type:"",text:""}),3e3)},te=async()=>{if(!_.trim())return;U(!0),C("");const n=[...m,...f].map(r=>`${r.quantity}x ${r.name} (${r.category})`).join(", "),s=`User asked: "${_}". Here is their shopping history: ${n}. Based on this, give a smart, concise answer. If they ask what to buy this month, suggest items they buy often, are seasonal, or are due for replacement. If they ask about low stock, infer from frequency. Reply as a helpful assistant.`;try{const r=oe.PERPLEXITY_PRO,c=await fetch("https://api.perplexity.ai/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:"You are a smart shopping assistant for maintenance and facility supplies."},{role:"user",content:s}]})});if(!c.ok)throw new Error("AI API error");const h=await c.json();C(h.choices[0].message.content)}catch{C("Sorry, I could not process your request.")}finally{U(!1)}},be=()=>{if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){alert("Speech Recognition not supported in this browser.");return}u.current&&(u.current.stop(),u.current.abort());const t=window.SpeechRecognition||window.webkitSpeechRecognition,n=new t;n.lang="en-US",n.interimResults=!1,n.maxAlternatives=1,n.continuous=!1,n.onresult=s=>{const r=s.results[0][0].transcript;pe(r),Y(r),M()},n.onend=()=>{R(!1),l.current&&(clearTimeout(l.current),l.current=null)},n.onerror=s=>{console.log("Speech recognition error:",s.error),R(!1),l.current&&(clearTimeout(l.current),l.current=null)},n.onstart=()=>{R(!0),l.current=setTimeout(()=>{M()},3e4)},u.current=n,n.start()},M=()=>{if(u.current){try{u.current.stop(),u.current.abort()}catch(t){console.log("Error stopping recognition:",t)}u.current=null}R(!1),l.current&&(clearTimeout(l.current),l.current=null)},Se=()=>{X(!0),I(""),b(!1)},ne=()=>{X(!1),d.current&&(d.current.stop(),d.current.abort()),b(!1)},we=()=>{if(!("webkitSpeechRecognition"in window||"SpeechRecognition"in window)){alert("Speech Recognition not supported in this browser.");return}d.current&&(d.current.stop(),d.current.abort());const t=window.SpeechRecognition||window.webkitSpeechRecognition,n=new t;n.lang="en-US",n.interimResults=!0,n.maxAlternatives=1,n.continuous=!1,n.onresult=s=>{const r=Array.from(s.results).map(c=>c[0]).map(c=>c.transcript).join("");I(r)},n.onend=()=>{b(!1),setTimeout(()=>{const s=document.getElementById("voice-modal-textarea");s&&s.focus()},100)},n.onerror=s=>{console.log("Voice modal error:",s.error),b(!1)},n.onstart=()=>{b(!0),I("")},d.current=n,n.start()},je=()=>{d.current&&(d.current.stop(),d.current.abort()),b(!1)},ke=()=>{y.trim()&&E(w?w+`
`+y:y),ne()};return e.jsxs("div",{className:"shopping-container",children:[e.jsx("h1",{children:"Shopping List"}),e.jsxs("div",{style:{marginBottom:24,padding:16,background:i.background,borderRadius:16,boxShadow:"0 2px 12px #bfc1c2",border:`1px solid ${i.accent}`},children:[e.jsx("h2",{style:{marginBottom:8,color:i.primary,fontWeight:800},children:"Smart Shopping Assistant"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Ask e.g. 'What should I buy this month?'",value:_,onChange:t=>Y(t.target.value),style:{flex:1,padding:12,borderRadius:12,border:`1.5px solid ${i.accent}`,fontSize:18,background:i.white,color:i.black,boxShadow:"0 1px 4px #e6f4ea"},onKeyDown:t=>{t.key==="Enter"&&te()}}),e.jsx("button",{onClick:p?M:be,style:{background:p?i.primary:i.accent,color:p?i.white:i.primary,border:"none",borderRadius:"50%",width:44,height:44,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:p?`0 0 8px 2px ${i.primary}`:"none",animation:p?"pulse 1s infinite":"none",cursor:"pointer",outline:"none",transition:"all 0.2s"},title:p?"Stop Listening":"Start Voice Input",children:p?e.jsx(re,{size:24}):e.jsx($,{size:24})}),e.jsx("button",{onClick:te,disabled:K,style:{padding:"12px 24px",borderRadius:12,background:i.primary,color:i.white,border:"none",fontWeight:700,fontSize:18,boxShadow:"0 1px 4px #bfc1c2"},children:K?"Thinking...":"Ask AI"})]}),p&&e.jsx("span",{style:{color:i.primary,fontWeight:600,marginLeft:8},children:"Listening..."}),Q&&!p&&e.jsxs("span",{style:{color:i.primary,marginLeft:8},children:['Heard: "',Q,'"']}),F&&e.jsx("div",{style:{marginTop:16,color:i.primary,background:i.highlight,padding:14,borderRadius:10,fontSize:17,fontWeight:500},children:F})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:()=>G("main"),style:{fontWeight:g==="main"?"bold":"normal"},children:"Main List"}),e.jsx("button",{onClick:()=>G("misc"),style:{fontWeight:g==="misc"?"bold":"normal"},children:"Misc List"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("h3",{children:"Shopping Analytics"}),e.jsxs("div",{children:["Total items: ",T.total||0]}),e.jsxs("div",{children:["Completed: ",T.completed||0]}),e.jsxs("div",{children:["By Category: ",Object.entries(T.byCategory||{}).map(([t,n])=>`${t}: ${n}`).join(", ")]}),J&&e.jsx("div",{style:{color:"orange",fontWeight:600},children:J})]}),e.jsx("div",{className:"shopping-list-container",children:Object.entries((g==="main"?m:f).reduce((t,n)=>(t[n.category]=t[n.category]||[],t[n.category].push(n),t),{})).map(([t,n])=>e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",fontWeight:700,fontSize:18,marginBottom:4},children:[me[t]||null,t]}),n.map((s,r)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#f1f5f9",borderRadius:6,padding:6,marginBottom:2},children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),s.brand&&e.jsxs("span",{children:["(",s.brand,")"]}),s.grainger_part&&e.jsx("a",{href:s.grainger_url,target:"_blank",rel:"noopener noreferrer",title:"View on Grainger",children:e.jsx(Ie,{size:16})}),s.home_depot_aisle&&e.jsx("a",{href:`https://www.homedepot.com/s/search?q=${s.name}`,target:"_blank",rel:"noopener noreferrer",title:"View on Home Depot",children:e.jsx(Le,{size:16})}),g==="main"&&e.jsx("button",{onClick:()=>xe(r),title:"Move to Misc",style:{marginLeft:8},children:"Move to Misc"})]},r))]},t))}),e.jsxs("div",{className:"input-section",children:[e.jsx("h2",{children:"Add Items"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",placeholder:`Add item to ${g} list (e.g., "10x LED bulbs")`,value:w,onChange:t=>E(t.target.value),onKeyPress:t=>{t.key==="Enter"&&P()}}),e.jsx("button",{onClick:Se,style:{background:i.accent,color:i.primary,border:"none",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",outline:"none",transition:"all 0.2s"},title:"Voice Input",children:e.jsx($,{size:20})}),e.jsx("button",{onClick:P,disabled:q,children:q?e.jsx(Ae,{className:"loader"}):e.jsx(Ee,{})})]})]}),H.length>0&&e.jsxs("div",{style:{marginTop:16,background:"#f6f6f6",padding:12,borderRadius:8},children:[e.jsx("b",{children:"AI Suggestions:"})," ",H.join(", ")]}),A.text&&e.jsx("div",{className:`message-box ${A.type}`,children:A.text}),ge&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:i.white,padding:24,borderRadius:16,boxShadow:"0 4px 20px rgba(0,0,0,0.3)",maxWidth:500,width:"90%",textAlign:"center"},children:[e.jsx("h3",{style:{color:i.primary,marginBottom:16},children:"Voice Input"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("button",{onClick:x?je:we,style:{background:x?i.primary:i.accent,color:x?i.white:i.primary,border:"none",borderRadius:"50%",width:60,height:60,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",boxShadow:x?`0 0 12px 4px ${i.primary}`:"none",animation:x?"pulse 1s infinite":"none",cursor:"pointer",outline:"none",transition:"all 0.2s"},children:x?e.jsx(re,{size:30}):e.jsx($,{size:30})}),e.jsx("p",{style:{marginTop:8,color:i.primary,fontWeight:600},children:x?"Listening... Click to stop":"Click to start speaking"})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{display:"block",textAlign:"left",marginBottom:8,color:i.primary,fontWeight:600},children:"Edit your text:"}),e.jsx("textarea",{id:"voice-modal-textarea",value:y,onChange:t=>I(t.target.value),placeholder:"Speak to add items to your shopping list...",style:{width:"100%",minHeight:100,padding:12,borderRadius:8,border:`1.5px solid ${i.accent}`,fontSize:16,fontFamily:"inherit",resize:"vertical",background:i.white,color:i.black}})]}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[e.jsx("button",{onClick:ne,style:{padding:"10px 20px",borderRadius:8,border:`1px solid ${i.accent}`,background:i.white,color:i.primary,cursor:"pointer",fontWeight:600},children:"Cancel"}),e.jsx("button",{onClick:ke,disabled:!y.trim(),style:{padding:"10px 20px",borderRadius:8,background:i.primary,color:i.white,border:"none",cursor:y.trim()?"pointer":"not-allowed",opacity:y.trim()?1:.5,fontWeight:600},children:"Add to List"})]})]})})]})};export{Ke as default};
//# sourceMappingURL=Shopping-hEx-O1qp.js.map
