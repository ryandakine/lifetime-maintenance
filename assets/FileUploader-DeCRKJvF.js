import{s as u,j as e}from"./main-D2OIwsnq.js";import{r as i}from"./vendor-B6114-rA.js";import{y as K,b as Q,p as Z,z as q,E as H,L as A,U as N,I as S,s as ee,G as re,R as oe,o as M,J as se,w as le,T as te,K as ie,N as ae,V as ne,F as z,O as de}from"./ui-7hvmghxF.js";import"./redux-CQk40qEf.js";const xe=()=>{console.log("FileUploader rendering!");const[g,b]=i.useState([]),[x,B]=i.useState(!1),[D,L]=i.useState(!1),[n,R]=i.useState({type:"",text:""}),[t,$]=i.useState(navigator.onLine),[I,v]=i.useState({}),[p,P]=i.useState(""),[y,f]=i.useState([]),[d,U]=i.useState("list"),[ce,pe]=i.useState([]),[E,j]=i.useState(!1),h=i.useRef(null);i.useEffect(()=>{const r=()=>$(!0),o=()=>$(!1);return window.addEventListener("online",r),window.addEventListener("offline",o),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",o)}},[]),i.useEffect(()=>{w()},[]),i.useEffect(()=>{if(!p.trim())f(g);else{const r=g.filter(o=>o.name.toLowerCase().includes(p.toLowerCase()));f(r)}},[p,g]);const w=async()=>{console.log("ðŸ”„ Loading files from Supabase Storage...");try{B(!0);const{data:r,error:o}=await u.storage.from("work-files").list("",{limit:100,offset:0});if(o)throw console.error("âŒ Error loading files:",o),o;console.log("âœ… Files loaded successfully:",(r==null?void 0:r.length)||0,"files"),b(r||[]),f(r||[])}catch(r){console.error("âŒ Error loading files:",r),t?a("error","Failed to load files. Check your connection."):a("error","You are offline. Files cannot be loaded."),b([]),f([])}finally{B(!1)}},W=r=>{const o=Array.from(r.target.files);console.log("ðŸ“ Files selected:",o.map(s=>s.name)),T(o)},Y=r=>{r.preventDefault(),j(!1);const o=Array.from(r.dataTransfer.files);console.log("ðŸ“ Files dropped:",o.map(s=>s.name)),T(o)},F=r=>{r.preventDefault(),r.stopPropagation(),r.type==="dragenter"||r.type==="dragover"?j(!0):r.type==="dragleave"&&j(!1)},T=async r=>{if(!r||r.length===0)return;if(!t){a("error","You are offline. Cannot upload files.");return}console.log("â¬†ï¸ Starting file upload process..."),L(!0);const o=[];for(const l of r)try{const m=`${Date.now()}-${l.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`;console.log(`â¬†ï¸ Uploading: ${l.name} as ${m}`),v(k=>({...k,[l.name]:0}));const{data:O,error:C}=await u.storage.from("work-files").upload(m,l,{cacheControl:"3600",upsert:!1});C?(console.error(`âŒ Upload failed for ${l.name}:`,C),o.push({file:l.name,success:!1,error:C.message})):(console.log(`âœ… Upload successful for ${l.name}:`,O),o.push({file:l.name,success:!0,data:O})),v(k=>({...k,[l.name]:100}))}catch(m){console.error(`âŒ Upload error for ${l.name}:`,m),o.push({file:l.name,success:!1,error:m.message})}const s=o.filter(l=>l.success).length,c=o.filter(l=>!l.success).length;s>0&&c===0?a("success",`Successfully uploaded ${s} file(s)`):s>0&&c>0?a("warning",`Uploaded ${s} file(s), ${c} failed`):a("error",`Failed to upload ${c} file(s)`),setTimeout(()=>{v({}),w()},1e3),L(!1),h.current&&(h.current.value="")},G=async r=>{if(console.log("â¬‡ï¸ Downloading file:",r),!t){a("error","You are offline. Cannot download files.");return}try{const{data:o,error:s}=await u.storage.from("work-files").download(r);if(s)throw console.error("âŒ Download error:",s),s;console.log("âœ… File downloaded successfully");const c=URL.createObjectURL(o),l=document.createElement("a");l.href=c,l.download=r.replace(/^\d+-/,""),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(c),a("success","File downloaded successfully")}catch(o){console.error("âŒ Error downloading file:",o),a("error","Failed to download file")}},X=async r=>{if(console.log("ðŸ—‘ï¸ Deleting file:",r),!t){a("error","You are offline. Cannot delete files.");return}if(confirm(`Are you sure you want to delete "${r}"?`))try{const{error:o}=await u.storage.from("work-files").remove([r]);if(o)throw console.error("âŒ Delete error:",o),o;console.log("âœ… File deleted successfully"),b(g.filter(s=>s.name!==r)),f(y.filter(s=>s.name!==r)),a("success","File deleted successfully")}catch(o){console.error("âŒ Error deleting file:",o),a("error","Failed to delete file")}},_=r=>{var s;switch((s=r.split(".").pop())==null?void 0:s.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"webp":return e.jsx(de,{size:20,style:{color:"var(--primary-color)"}});case"pdf":return e.jsx(z,{size:20,style:{color:"var(--danger-color)"}});case"doc":case"docx":return e.jsx(z,{size:20,style:{color:"var(--primary-color)"}});case"xls":case"xlsx":return e.jsx(z,{size:20,style:{color:"var(--success-color)"}});case"mp4":case"avi":case"mov":return e.jsx(ne,{size:20,style:{color:"var(--secondary-color)"}});case"mp3":case"wav":return e.jsx(ae,{size:20,style:{color:"var(--warning-text)"}});case"zip":case"rar":return e.jsx(ie,{size:20,style:{color:"var(--secondary-color)"}});default:return e.jsx(S,{size:20,style:{color:"var(--primary-color)"}})}},V=r=>r?r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:r<1024*1024*1024?`${(r/(1024*1024)).toFixed(1)} MB`:`${(r/(1024*1024*1024)).toFixed(1)} GB`:"Unknown size",J=async r=>{try{const{data:o}=await u.storage.from("work-files").getPublicUrl(r);await navigator.clipboard.writeText(o.publicUrl),a("success","File link copied to clipboard")}catch(o){console.error("âŒ Error copying link:",o),a("error","Failed to copy file link")}},a=(r,o)=>{console.log(`ðŸ“¢ Message: ${r} - ${o}`),R({type:r,text:o}),setTimeout(()=>R({type:"",text:""}),5e3)};return e.jsxs("div",{className:"container",style:{maxWidth:"1200px",margin:"0 auto",padding:"1rem"},children:[!t&&e.jsxs("div",{style:{backgroundColor:"var(--warning-color)",color:"var(--dark-color)",padding:"1rem",borderRadius:"8px",marginBottom:"1rem",border:"1px solid var(--warning-color)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(K,{size:20}),"âš ï¸ You are currently offline. File operations may not work properly."]}),n.text&&e.jsxs("div",{style:{backgroundColor:n.type==="success"?"var(--success-color)":n.type==="warning"?"var(--warning-color)":"var(--danger-color)",color:"var(--white)",padding:"1rem",borderRadius:"8px",marginBottom:"1rem",border:`1px solid ${n.type==="success"?"var(--success-color)":n.type==="warning"?"var(--warning-color)":"var(--danger-color)"}`,display:"flex",alignItems:"center",gap:"0.5rem"},children:[n.type==="success"?e.jsx(Q,{size:20}):n.type==="warning"?e.jsx(Z,{size:20}):e.jsx(q,{size:20}),n.text]}),e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",border:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,123,255,0.1)"},children:[e.jsxs("h2",{style:{color:"#007BFF",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(H,{size:24}),"Upload Work Files"]}),e.jsxs("div",{onDragEnter:F,onDragLeave:F,onDragOver:F,onDrop:Y,style:{border:`2px dashed ${E?"var(--primary-color)":"#dee2e6"}`,borderRadius:"8px",padding:"3rem 2rem",textAlign:"center",backgroundColor:E?"var(--light-color)":"#f8f9fa",cursor:"pointer",transition:"all 0.2s ease",position:"relative"},onClick:()=>{var r;return(r=h.current)==null?void 0:r.click()},children:[e.jsx("label",{htmlFor:"file-upload",style:{display:"none"},children:"Choose file to upload"}),e.jsx("input",{ref:h,type:"file",multiple:!0,onChange:W,style:{display:"none"},disabled:D||!t,id:"file-upload",name:"file-upload","aria-label":"Choose file to upload",title:"Choose file to upload"}),D?e.jsxs("div",{children:[e.jsx(A,{size:48,style:{color:"#007BFF",marginBottom:"1rem",animation:"spin 1s linear infinite"},"aria-hidden":"true"}),e.jsx("h3",{style:{color:"var(--primary-color)",marginBottom:"0.5rem"},children:"Uploading Files..."}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--secondary-color)"},children:"Please wait while your files are being uploaded"})]}):e.jsxs("div",{children:[e.jsx(N,{size:48,style:{color:"var(--primary-color)",marginBottom:"1rem"},"aria-hidden":"true"}),e.jsx("h3",{style:{color:"var(--primary-color)",marginBottom:"0.5rem"},children:"Drop files here or click to browse"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--secondary-color)",margin:0},children:"Supports: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, MP4, ZIP and more"}),!t&&e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--danger-color)",marginTop:"0.5rem"},children:"Upload requires internet connection"})]})]}),Object.keys(I).length>0&&e.jsx("div",{style:{marginTop:"1rem"},children:Object.entries(I).map(([r,o])=>e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.9rem",marginBottom:"0.25rem"},children:[e.jsx("span",{children:r}),e.jsxs("span",{children:[o,"%"]})]}),e.jsx("div",{style:{width:"100%",height:"4px",backgroundColor:"#e9ecef",borderRadius:"2px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${o}%`,height:"100%",backgroundColor:"#007BFF",transition:"width 0.3s ease"}})})]},r))})]}),e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",border:"1px solid #e9ecef",boxShadow:"0 2px 4px rgba(0,123,255,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("h2",{style:{color:"#007BFF",margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(S,{size:24}),"Work Files (",y.length,")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[e.jsx("button",{onClick:()=>U("list"),style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:d==="list"?"#007BFF":"#f8f9fa",color:d==="list"?"white":"#6c757d",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>U("grid"),style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:d==="grid"?"#007BFF":"#f8f9fa",color:d==="grid"?"white":"#6c757d",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(re,{size:16})}),e.jsx("button",{onClick:w,disabled:x,style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:"#f8f9fa",color:"#6c757d",cursor:x?"not-allowed":"pointer",display:"flex",alignItems:"center"},children:e.jsx(oe,{size:16,style:{animation:x?"spin 1s linear infinite":"none"}})})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{htmlFor:"search-input",className:"form-label",style:{marginBottom:"0.5rem",display:"block"},children:"Search Files"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search files...",value:p,onChange:r=>P(r.target.value),style:{width:"100%",padding:"0.75rem 2.5rem 0.75rem 1rem",border:"1px solid #dee2e6",borderRadius:"8px",fontSize:"1rem",outline:"none",transition:"border-color 0.2s ease"},onFocus:r=>r.target.style.borderColor="#007BFF",onBlur:r=>r.target.style.borderColor="#dee2e6",id:"search-input",name:"search-input","aria-label":"Search files"}),e.jsx(M,{size:16,style:{position:"absolute",right:"1rem",top:"50%",transform:"translateY(-50%)",color:"#6c757d"}})]})]}),x?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#6c757d"},children:[e.jsx(A,{size:32,style:{marginBottom:"1rem",animation:"spin 1s linear infinite"}}),e.jsx("div",{children:"Loading files..."})]}):y.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#6c757d"},children:p?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:48,style:{marginBottom:"1rem",opacity:.5}}),e.jsx("div",{children:"No files match your search"})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:48,style:{marginBottom:"1rem",opacity:.5}}),e.jsx("div",{children:"No files uploaded yet"}),e.jsx("div",{style:{fontSize:"0.9rem",marginTop:"0.5rem"},children:"Upload your first work file above"})]})}):e.jsx("div",{style:{display:d==="grid"?"grid":"flex",flexDirection:d==="list"?"column":void 0,gridTemplateColumns:d==="grid"?"repeat(auto-fill, minmax(280px, 1fr))":void 0,gap:"1rem"},children:y.map(r=>{var o;return e.jsx("div",{style:{border:"1px solid #e9ecef",borderRadius:"8px",padding:"1rem",backgroundColor:"#fafafa",transition:"all 0.2s ease",cursor:"default"},onMouseEnter:s=>{s.currentTarget.style.borderColor="#007BFF",s.currentTarget.style.backgroundColor="#f8f9ff"},onMouseLeave:s=>{s.currentTarget.style.borderColor="#e9ecef",s.currentTarget.style.backgroundColor="#fafafa"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1},children:[_(r.name),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontWeight:"600",color:"#212529",marginBottom:"0.25rem",wordBreak:"break-word"},children:r.name.replace(/^\d+-/,"")}),e.jsx("div",{style:{fontSize:"0.85rem",color:"#6c757d",marginBottom:"0.25rem"},children:V((o=r.metadata)==null?void 0:o.size)}),r.updated_at&&e.jsxs("div",{style:{fontSize:"0.8rem",color:"#6c757d"},children:[new Date(r.updated_at).toLocaleDateString()," ",new Date(r.updated_at).toLocaleTimeString()]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",flexShrink:0},children:[e.jsx("button",{onClick:()=>G(r.name),disabled:!t,style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:t?"#007BFF":"#6c757d",color:"white",cursor:t?"pointer":"not-allowed",display:"flex",alignItems:"center",fontSize:"0.8rem"},title:"Download file","aria-label":"Download file",children:e.jsx(se,{size:14})}),e.jsx("button",{onClick:()=>J(r.name),disabled:!t,style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:t?"#28a745":"#6c757d",color:"white",cursor:t?"pointer":"not-allowed",display:"flex",alignItems:"center",fontSize:"0.8rem"},title:"Copy file link","aria-label":"Copy file link",children:e.jsx(le,{size:14})}),e.jsx("button",{onClick:()=>X(r.name),disabled:!t,style:{padding:"0.5rem",border:"none",borderRadius:"6px",backgroundColor:t?"#dc3545":"#6c757d",color:"white",cursor:t?"pointer":"not-allowed",display:"flex",alignItems:"center",fontSize:"0.8rem"},title:"Delete file","aria-label":"Delete file",children:e.jsx(te,{size:14,"aria-hidden":"true"})})]})]})},r.name)})})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
          .container {
            padding: 0.5rem;
          }
        }
      `})]})};export{xe as default};
//# sourceMappingURL=FileUploader-DeCRKJvF.js.map
