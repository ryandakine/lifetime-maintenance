use colored::*;
use inquire::{Select, Text};
use std::{thread, time::Duration};

struct Lesson {
    title: &'static str,
    cmd: &'static str,
    desc: &'static str,
}

fn main() {
    print!("{}[2J", 27 as char); // Clear screen
    println!("{}", "OSI KALI DOJO - TACTICAL TRAINING".bold().green());
    println!("{}", "Train like you fight.\n".italic());

    loop {
        let options = vec![
            "Reconnaissance (TheHarvester, Nmap)",
            "Web Assessment (Nikto, Gobuster)",
            "Exploitation (Metasploit)",
            "Quit"
        ];

        let ans = Select::new("Select Training Module:", options).prompt();

        match ans {
            Ok("Reconnaissance (TheHarvester, Nmap)") => run_recon(),
            Ok("Web Assessment (Nikto, Gobuster)") => run_web(),
            Ok("Exploitation (Metasploit)") => run_exploit(),
            Ok("Quit") => break,
            _ => println!("Invalid selection"),
        }
    }
}

fn run_lesson(lessons: Vec<Lesson>) {
    for lesson in lessons {
        println!("\n{}", "----------------------------------------".blue());
        println!("DRILL: {}", lesson.title.bold().yellow());
        println!("DESC:  {}", lesson.desc);
        println!("CMD:   {}", lesson.cmd.on_black().white());
        println!("{}", "----------------------------------------".blue());

        // Simple simulation check
        let _ = Text::new("Type the command (or Enter to simulate):").prompt();
        
        println!("{}", "Simulating execution...".dimmed());
        thread::sleep(Duration::from_millis(800));
        println!("{}", "âœ” DRILL COMPLETE".green());
        thread::sleep(Duration::from_millis(500));
    }
}

fn run_recon() {
    let lessons = vec![
        Lesson { 
            title: "Passive Recon", 
            cmd: "theHarvester -d target.com -b google", 
            desc: "Gather emails and subdomains without touching the target." 
        },
        Lesson { 
            title: "Stealth Scan", 
            cmd: "nmap -sS -p- <IP>", 
            desc: "Scan all 65535 ports using SYN Stealth mode." 
        },
        Lesson { 
            title: "Service Versioning", 
            cmd: "nmap -sV -sC <IP>", 
            desc: "Identify service versions and run default scripts." 
        },
    ];
    run_lesson(lessons);
}

fn run_web() {
    let lessons = vec![
        Lesson { 
            title: "Web Vulnerability Scan", 
            cmd: "nikto -h http://target.com", 
            desc: "Scan for outdated server software and misconfigs." 
        },
        Lesson { 
            title: "Directory Brute Force", 
            cmd: "gobuster dir -u http://target.com -w common.txt", 
            desc: "Find hidden directories (admin, backup, etc)." 
        },
    ];
    run_lesson(lessons);
}

fn run_exploit() {
    let lessons = vec![
        Lesson { 
            title: "Offline Exploit Search", 
            cmd: "searchsploit apache 2.4", 
            desc: "Search local Exploit-DB copy for matches." 
        },
        Lesson { 
            title: "Metasploit Framework", 
            cmd: "msfconsole", 
            desc: "Launch the primary exploitation framework." 
        },
    ];
    run_lesson(lessons);
}
