#!/usr/bin/env python3
import time
import os
from rich.console import Console
from rich.panel import Panel
from rich.prompt import Prompt
from rich.markdown import Markdown

console = Console()

CURRICULUM = {
    "1": {
        "title": "Reconnaissance",
        "tools": [
            {"name": "theHarvester", "cmd": "theHarvester -d target.com -b google", "desc": "Passive email/subdomain gathering."},
            {"name": "Nmap (Stealth)", "cmd": "nmap -sS <IP>", "desc": "Active port scanning using SYN packets (stealthy)."},
            {"name": "Nmap (Version)", "cmd": "nmap -sV <IP>", "desc": "Detect service versions on open ports."}
        ]
    },
    "2": {
        "title": "Web App Assessment",
        "tools": [
            {"name": "Nikto", "cmd": "nikto -h http://target.com", "desc": "Scan web server for known vulnerabilities."},
            {"name": "Gobuster", "cmd": "gobuster dir -u http://target.com -w common.txt", "desc": "Brute-force URL directories."}
        ]
    },
    "3": {
        "title": "Exploitation",
        "tools": [
            {"name": "Metasploit", "cmd": "msfconsole", "desc": "Launch the Framework."},
            {"name": "SearchSploit", "cmd": "searchsploit apache 2.4", "desc": "Search offline exploit database."}
        ]
    }
}

def run_dojo():
    console.print(Panel("[bold green]OSI KALI DOJO[/bold green]\n[italic]Train like you fight.[/italic]"))
    
    while True:
        console.print("\n[bold cyan]Select Training Phase:[/bold cyan]")
        for k, v in CURRICULUM.items():
            console.print(f"[{k}] {v['title']}")
        console.print("[Q] Quit")
        
        choice = Prompt.ask("Selection").upper()
        if choice == 'Q': break
        
        if choice in CURRICULUM:
            phase = CURRICULUM[choice]
            console.print(f"\n[bold yellow]ENTERING PHASE: {phase['title'].upper()}[/bold yellow]")
            
            for tool in phase['tools']:
                console.print(Panel(f"[bold]{tool['name']}[/bold]\n{tool['desc']}", border_style="blue"))
                console.print(f"Try running: [green]{tool['cmd']}[/green]")
                
                # Simulation Mode
                # Real execution is dangerous in auto-mode, so we just simulate or ask user to run in another term
                Prompt.ask("Press Enter once you have practiced this command...")
                console.print("[green]âœ” Drill Complete.[/green]\n")
                
if __name__ == "__main__":
    run_dojo()
